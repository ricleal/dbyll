---
layout: post
title: 'C++11 : Interface Test for dummies...'
date: '2013-04-05T10:12:00.001-04:00'
author: ricleal
tags:
- Programming
- C++
excerpt: '...'
comments: true
---

<br />
<pre><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">iostream</span><span style="color: maroon;">&gt;</span><br /><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">string</span><span style="color: maroon;">&gt;</span><br /><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">map</span><span style="color: maroon;">&gt;</span><br /><span style="color: #004a43;">#</span><span style="color: #004a43;">include </span><span style="color: maroon;">&lt;</span><span style="color: #40015a;">memory</span><span style="color: maroon;">&gt;</span><br /><br /><span style="color: maroon; font-weight: bold;">using</span> <span style="color: maroon; font-weight: bold;">namespace</span> <span style="color: #666616;">std</span><span style="color: purple;">;</span><br /><br /><br /><span style="color: #3f5fbf;">/**</span><br /><span style="color: #3f5fbf;">&nbsp;* Server Interface</span><br /><span style="color: #3f5fbf;">&nbsp;*/</span><br /><span style="color: maroon; font-weight: bold;">class</span> IServer <span style="color: purple;">{</span><br /><span style="color: maroon; font-weight: bold;">protected</span><span style="color: #e34adc;">:</span><br />    <span style="color: #603000;">string</span> protocol<span style="color: purple;">;</span><br /><span style="color: maroon; font-weight: bold;">public</span><span style="color: #e34adc;">:</span><br />    <span style="color: maroon; font-weight: bold;">virtual</span> <span style="color: maroon; font-weight: bold;">void</span> reponse<span style="color: #808030;">(</span><span style="color: #808030;">)</span> <span style="color: #808030;">=</span> <span style="color: #008c00;">0</span><span style="color: purple;">;</span><br />    <span style="color: maroon; font-weight: bold;">virtual</span> <span style="color: maroon; font-weight: bold;">void</span> accept<span style="color: #808030;">(</span><span style="color: #603000;">string</span> message<span style="color: #808030;">)</span> <span style="color: #808030;">=</span> <span style="color: #008c00;">0</span><span style="color: purple;">;</span><br /><span style="color: purple;">}</span><span style="color: purple;">;</span><br /><br /><span style="color: #3f5fbf;">/**</span><br /><span style="color: #3f5fbf;">&nbsp;* Server Factory</span><br /><span style="color: #3f5fbf;">&nbsp;*/</span><br /><span style="color: maroon; font-weight: bold;">class</span> Factory<br /><span style="color: purple;">{</span><br /><span style="color: maroon; font-weight: bold;">public</span><span style="color: #e34adc;">:</span><br />    <span style="color: dimgrey;">//virtual IServer* create() = 0;</span><br />    <span style="color: maroon; font-weight: bold;">virtual</span> <span style="color: #666616;">std</span><span style="color: purple;">::</span>shared_ptr<span style="color: purple;">&lt;</span>IServer<span style="color: purple;">&gt;</span> create<span style="color: #808030;">(</span><span style="color: #603000;">string</span> s<span style="color: #808030;">)</span> <span style="color: #808030;">=</span> <span style="color: #008c00;">0</span><span style="color: purple;">;</span><br /><span style="color: purple;">}</span><span style="color: purple;">;</span><br /><br /><span style="color: maroon; font-weight: bold;">template</span> <span style="color: purple;">&lt;</span><span style="color: maroon; font-weight: bold;">class</span> aServer<span style="color: purple;">&gt;</span><br /><span style="color: maroon; font-weight: bold;">class</span> ServerFactory <span style="color: purple;">:</span> <span style="color: maroon; font-weight: bold;">public</span> Factory<br /><span style="color: purple;">{</span><br /><span style="color: maroon; font-weight: bold;">public</span><span style="color: #e34adc;">:</span><br />   <span style="color: dimgrey;">//IServer* create() { return new aServer(); }</span><br />   <span style="color: #666616;">std</span><span style="color: purple;">::</span>shared_ptr<span style="color: purple;">&lt;</span>IServer<span style="color: purple;">&gt;</span> create<span style="color: #808030;">(</span><span style="color: #603000;">string</span> s<span style="color: #808030;">)</span> <span style="color: purple;">{</span> <span style="color: maroon; font-weight: bold;">return</span> <span style="color: #666616;">std</span><span style="color: purple;">::</span>make_shared<span style="color: purple;">&lt;</span>aServer<span style="color: purple;">&gt;</span><span style="color: #808030;">(</span>s<span style="color: #808030;">)</span><span style="color: purple;">;</span> <span style="color: purple;">}</span><br /><span style="color: purple;">}</span><span style="color: purple;">;</span><br /><br /><br /><br /><span style="color: #3f5fbf;">/**</span><br /><span style="color: #3f5fbf;">&nbsp;* A server</span><br /><span style="color: #3f5fbf;">&nbsp;*/</span><br /><span style="color: maroon; font-weight: bold;">class</span> Server1 <span style="color: purple;">:</span> <span style="color: maroon; font-weight: bold;">public</span> IServer <span style="color: purple;">{</span><br /><span style="color: maroon; font-weight: bold;">public</span><span style="color: #e34adc;">:</span><br />    Server1<span style="color: #808030;">(</span><span style="color: #603000;">string</span> protocol_<span style="color: #808030;">)</span> <span style="color: purple;">{</span><br />        <span style="color: dimgrey;">// does not work as normal constructor variable</span><br />        protocol <span style="color: #808030;">=</span> protocol_<span style="color: purple;">;</span> <br />        <span style="color: #603000;">cout</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> <span style="color: maroon;">"</span><span style="color: #0000e6;">Server1 constructor with protocol: </span><span style="color: maroon;">"</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> protocol <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> endl<span style="color: purple;">;</span><br />        <br />    <span style="color: purple;">}</span><br />    <span style="color: maroon; font-weight: bold;">void</span> reponse<span style="color: #808030;">(</span><span style="color: #808030;">)</span><span style="color: purple;">{</span><br />        <span style="color: #603000;">cout</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> <span style="color: maroon;">"</span><span style="color: #0000e6;">Server1 Responding with protocol: </span><span style="color: maroon;">"</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> protocol <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> endl<span style="color: purple;">;</span><br />    <span style="color: purple;">}</span><br />    <span style="color: maroon; font-weight: bold;">void</span> accept<span style="color: #808030;">(</span><span style="color: #603000;">string</span> message<span style="color: #808030;">)</span><span style="color: purple;">{</span><br />        <span style="color: #603000;">cout</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> <span style="color: maroon;">"</span><span style="color: #0000e6;">Server1 accepted message with protocol: </span><span style="color: maroon;">"</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> protocol <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> endl<span style="color: purple;">;</span><br />        <span style="color: #603000;">cout</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> <span style="color: maroon;">"</span><span style="color: #0000e6;">Message: </span><span style="color: maroon;">"</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> message <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> endl<span style="color: purple;">;</span><br />    <span style="color: purple;">}</span><br /><span style="color: purple;">}</span><span style="color: purple;">;</span><br /><br /><br /><span style="color: #3f5fbf;">/**</span><br /><span style="color: #3f5fbf;">&nbsp;* The client</span><br /><span style="color: #3f5fbf;">&nbsp;*/</span><br /><span style="color: maroon; font-weight: bold;">class</span> Client <span style="color: purple;">{</span><br /><span style="color: maroon; font-weight: bold;">private</span><span style="color: #e34adc;">:</span><br />    <span style="color: #603000;">string</span> id<span style="color: purple;">;</span><br />    <span style="color: #666616;">std</span><span style="color: purple;">::</span>shared_ptr<span style="color: purple;">&lt;</span>IServer<span style="color: purple;">&gt;</span> server<span style="color: purple;">;</span><br /><span style="color: maroon; font-weight: bold;">public</span><span style="color: #e34adc;">:</span><br />    Client<span style="color: #808030;">(</span><span style="color: #603000;">string</span> clientId<span style="color: #808030;">)</span> <span style="color: purple;">:</span> id<span style="color: #808030;">(</span>clientId<span style="color: #808030;">)</span><span style="color: purple;">{</span><br />       <span style="color: #603000;">cout</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> <span style="color: maroon;">"</span><span style="color: #0000e6;">Client constructor with id: </span><span style="color: maroon;">"</span> <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> clientId <span style="color: #808030;">&lt;</span><span style="color: #808030;">&lt;</span> endl<span style="color: purple;">;</span><br />    <span style="color: purple;">}</span><br />    <span style="color: maroon; font-weight: bold;">void</span> setServer<span style="color: #808030;">(</span><span style="color: #666616;">std</span><span style="color: purple;">::</span>shared_ptr<span style="color: purple;">&lt;</span>IServer<span style="color: purple;">&gt;</span> server_<span style="color: #808030;">)</span><span style="color: purple;">{</span><br />        server <span style="color: #808030;">=</span> server_<span style="color: purple;">;</span><br />    <span style="color: purple;">}</span><br />    <span style="color: maroon; font-weight: bold;">void</span> request<span style="color: #808030;">(</span><span style="color: #603000;">string</span> message<span style="color: #808030;">)</span> <span style="color: purple;">{</span><br />        server<span style="color: #808030;">-</span><span style="color: #808030;">&gt;</span>accept<span style="color: #808030;">(</span>message<span style="color: #808030;">)</span><span style="color: purple;">;</span><br />        server<span style="color: #808030;">-</span><span style="color: #808030;">&gt;</span>reponse<span style="color: #808030;">(</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br />    <span style="color: purple;">}</span><br /><span style="color: purple;">}</span><span style="color: purple;">;</span><br /><br /><span style="color: maroon; font-weight: bold;">int</span> <span style="color: #400000;">main</span> <span style="color: #808030;">(</span><span style="color: maroon; font-weight: bold;">void</span><span style="color: #808030;">)</span>  <span style="color: purple;">{</span><br />    <span style="color: dimgrey;">// register server 1 in the::make_shared<myclass>(1);  factory</myclass></span><br />    <span style="color: #666616;">std</span><span style="color: purple;">::</span><span style="color: #603000;">map</span><span style="color: purple;">&lt;</span><span style="color: #603000;">string</span><span style="color: #808030;">,</span> <span style="color: #666616;">std</span><span style="color: purple;">::</span>shared_ptr<span style="color: purple;">&lt;</span>Factory<span style="color: purple;">&gt;</span> <span style="color: purple;">&gt;</span> factoryMap<span style="color: purple;">;</span><br />    factoryMap<span style="color: #808030;">[</span><span style="color: maroon;">"</span><span style="color: #0000e6;">Server1</span><span style="color: maroon;">"</span><span style="color: #808030;">]</span> <span style="color: #808030;">=</span> <span style="color: #666616;">std</span><span style="color: purple;">::</span>make_shared<span style="color: purple;">&lt;</span> ServerFactory<span style="color: purple;">&lt;</span>Server1<span style="color: purple;">&gt;</span> <span style="color: purple;">&gt;</span><span style="color: #808030;">(</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br /><br />    <span style="color: dimgrey;">//Server1 s("DummyProtocol");</span><br />    <span style="color: maroon; font-weight: bold;">auto</span> s <span style="color: #808030;">=</span> factoryMap<span style="color: #808030;">[</span><span style="color: maroon;">"</span><span style="color: #0000e6;">Server1</span><span style="color: maroon;">"</span><span style="color: #808030;">]</span><span style="color: #808030;">-</span><span style="color: #808030;">&gt;</span>create<span style="color: #808030;">(</span><span style="color: maroon;">"</span><span style="color: #0000e6;">DummyProtocol</span><span style="color: maroon;">"</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br /><br />    Client c<span style="color: #808030;">(</span><span style="color: maroon;">"</span><span style="color: #0000e6;">Dummy Client</span><span style="color: maroon;">"</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br />    c<span style="color: #808030;">.</span>setServer<span style="color: #808030;">(</span>s<span style="color: #808030;">)</span><span style="color: purple;">;</span><br />    c<span style="color: #808030;">.</span>request<span style="color: #808030;">(</span><span style="color: maroon;">"</span><span style="color: #0000e6;">Dummy Message!</span><span style="color: maroon;">"</span><span style="color: #808030;">)</span><span style="color: purple;">;</span><br /><br />    <span style="color: maroon; font-weight: bold;">return</span> <span style="color: #008c00;">0</span><span style="color: purple;">;</span><br /><span style="color: purple;">}</span></pre>