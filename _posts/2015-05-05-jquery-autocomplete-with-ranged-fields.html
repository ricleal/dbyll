---
layout: post
title: JQuery autocomplete with ranged fields
date: '2015-05-05T10:38:00.002-04:00'
author: ricleal
tags: ['JavaScript', 'Programming', 'JQuery']
excerpt: RFew weeks ago I was looking for a way to get a form field autocomplete from a remote JSON file with a single HTTP request.
comments: true
---

<div
    style="color: #444444; font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif; font-size: 16px; line-height: 24px; margin-bottom: 1em; margin-top: 1em;">
    Few weeks ago I was looking for a way to get a form field <i>autocomplete</i> from a remote JSON file with a single
    HTTP request. The solution is&nbsp;<a
        href="http://ricleal.blogspot.com/2015/02/jquery-javascript-autocomplete-with.html"
        style="color: #0b0080; text-decoration: none;">here</a>.</div>
<div
    style="color: #444444; font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif; font-size: 16px; line-height: 24px; margin-bottom: 1em; margin-top: 1em;">
    Now I want to do the same but using ranged fields (i.e., sort of an array where commas separate items and hyphen
    define ranges). A valid field would be:&nbsp;<code
        style="background-color: #f8f8f8; border-radius: 3px; border: 1px solid rgb(204, 204, 204); color: black; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.94em; padding: 0px 3px;">1-8,10,13,15-20</code>.
</div>
<div class="separator" style="clear: both; text-align: center;"><a
        href="http://3.bp.blogspot.com/-d0XJoNyzKOM/VUjV-ZAlzII/AAAAAAAAk4U/mnJk7bT70lw/s1600/Screenshot%2Bfrom%2B2015-05-05%2B10%3A28%3A12.png"
        imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="193"
            src="http://3.bp.blogspot.com/-d0XJoNyzKOM/VUjV-ZAlzII/AAAAAAAAk4U/mnJk7bT70lw/s640/Screenshot%2Bfrom%2B2015-05-05%2B10%3A28%3A12.png"
            width="640" /></a></div>
<div
    style="color: #444444; font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif; font-size: 16px; line-height: 24px; margin-bottom: 1em; margin-top: 1em;">
    <br /></div>
<div
    style="color: #444444; font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif; font-size: 16px; line-height: 24px; margin-bottom: 1em; margin-top: 1em;">
    Here the javascript / JQuery code:</div>
<pre
    style="background-color: #f8f8f8; border-radius: 3px; border: 1px solid rgb(204, 204, 204); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.94em; line-height: 24px; padding: 5px; white-space: pre-wrap; word-wrap: break-word;"><code class="language-javascript" style="background: transparent !important; border-radius: 3px; border: 0px !important; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.94em; line-height: 1.3em; padding: 0px 3px;">    <span class="hljs-comment" style="color: #888888;">/* Function to populate the autocomplete from a remote json.<br />      For ranged fields, .e.g,: 4588-4590,465-658 */</span><br />    <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-title" style="color: #880000; font-weight: bold;">split</span><span class="hljs-params">(val)</span> </span>{<br />        <span class="hljs-keyword" style="font-weight: bold;">return</span> val.split(<span class="hljs-regexp" style="color: #008800;">/[,-]\s*/</span>);<br />    }<br /><br />    <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-title" style="color: #880000; font-weight: bold;">extractLast</span><span class="hljs-params">(term)</span> </span>{<br />        <span class="hljs-keyword" style="font-weight: bold;">return</span> split(term).pop();<br />    }<br /><br />    <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-title" style="color: #880000; font-weight: bold;">set_autocomplete_ranged</span><span class="hljs-params">(selector, jsonurl)</span> </span>{<br />        $.ajax({<br />            url: jsonurl,<br />            type: <span class="hljs-string" style="color: #880000;">'get'</span>,<br />            dataType: <span class="hljs-string" style="color: #880000;">'json'</span>,<br />            async: <span class="hljs-literal" style="color: #008800;">true</span>,<br />            success: <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-params">(data)</span> </span>{                <br />                $(selector).autocomplete({<br />                    minLength: <span class="hljs-number" style="color: #008800;">0</span>,<br />                    source: <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-params">(request, response)</span> </span>{<br />                        response($.ui.autocomplete.filter(<br />                        data, extractLast(request.term) ));<br />                    },<br />                    focus: <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-params">()</span> </span>{<br />                        <span class="hljs-keyword" style="font-weight: bold;">return</span> <span class="hljs-literal" style="color: #008800;">false</span>;<br />                    },<br />                    select: <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-params">(event, ui)</span> </span>{<br />                        <span class="hljs-keyword" style="font-weight: bold;">var</span> this_value = ui.item.value<br />                        <span class="hljs-keyword" style="font-weight: bold;">var</span> all_values = <span class="hljs-keyword" style="font-weight: bold;">this</span>.value<br />                        <span class="hljs-keyword" style="font-weight: bold;">this</span>.value = all_values + this_value<br />                        <span class="hljs-keyword" style="font-weight: bold;">return</span> <span class="hljs-literal" style="color: #008800;">false</span>;<br />                    }<br />                }).bind(<span class="hljs-string" style="color: #880000;">'focus'</span>, <span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span> <span class="hljs-params">()</span> </span>{<br />                    <span class="hljs-keyword" style="font-weight: bold;">if</span> (!$(<span class="hljs-keyword" style="font-weight: bold;">this</span>).val().trim()) $(<span class="hljs-keyword" style="font-weight: bold;">this</span>).keydown();<br />                });<br />            }<br />        });<br />    }<br /></code></pre>
<div
    style="color: #444444; font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif; font-size: 16px; line-height: 24px; margin-bottom: 1em; margin-top: 1em;">
    An then just add the URL for the JSON and the&nbsp;<code
        style="background-color: #f8f8f8; border-radius: 3px; border: 1px solid rgb(204, 204, 204); color: black; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.94em; padding: 0px 3px;">id</code>&nbsp;for
    the field you want to use the ranged autocomplete:</div>
<pre
    style="background-color: #f8f8f8; border-radius: 3px; border: 1px solid rgb(204, 204, 204); font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.94em; line-height: 24px; padding: 5px; white-space: pre-wrap; word-wrap: break-word;"><code class="language-javascript" style="background: transparent !important; border-radius: 3px; border: 0px !important; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.94em; line-height: 1.3em; padding: 0px 3px;">    <span class="hljs-comment" style="color: #888888;">/*<br />    Function called only once! It populates the autocomplete from a remote json.<br />    The filtering is made locally as the source is a local variable :)<br />    */</span><br />    $(<span class="hljs-function"><span class="hljs-keyword" style="font-weight: bold;">function</span><span class="hljs-params">()</span> </span>{<br />        <span class="hljs-keyword" style="font-weight: bold;">var</span> jsonurl = <span class="hljs-string" style="color: #880000;">"http://mysite.com/myjson.json"</span>;<br />        <span class="hljs-keyword" style="font-weight: bold;">var</span> selector = <span class="hljs-string" style="color: #880000;">'#id_ranged_field'</span>;<br />        <span class="hljs-keyword" style="font-weight: bold;">if</span>  ($(selector).is(<span class="hljs-string" style="color: #880000;">'*'</span>)) {<br />            set_autocomplete_ranged(selector,jsonurl);<br />        }<br />    });</code></pre>