---
layout: post
title: 'RVO: Return value optimization and NRVO: Named return value optimization'
date: '2013-07-12T16:00:00.000-04:00'
author: ricleal
tags:
- Programming
- C++
comments: true
---

<br />Note the last lines:<br /><br />Here no copy constructors are involved:<br />
<pre class="de1"
    style="background-color: #fafafa; color: #000066; font-size: 13px; padding-bottom: 5px; padding-left: 10px; padding-top: 3px;">MyClass <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>m14 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f3<span class="br0" style="color: green; line-height: 13px !important;">(</span>m11<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span> <span class="co1" style="color: #666666; line-height: 13px !important;">// if function return ref this is OK! NO COPY!</span></pre>
<br /><br />But the same variable (which is not an lvalue anymore!) calls a copy constructor when assigned:<br />
<pre class="de1"
    style="background-color: #fafafa; color: #000066; font-size: 13px; padding-bottom: 5px; padding-left: 10px; padding-top: 3px;">&nbsp; &nbsp; m14 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f3<span class="br0" style="color: green; line-height: 13px !important;">(</span>m14<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span></pre>
<br />Took me a while to understand why the the heck the copy constructor were beeing called!<br />
<pre class="de1"
    style="background-color: #fafafa; color: #000066; font-size: 13px; padding-bottom: 5px; padding-left: 10px; padding-top: 3px;">&nbsp;<br /><span class="kw2" style="color: blue; line-height: 13px !important;">class</span> MyClass <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; <span class="kw4" style="color: blue; line-height: 13px !important;">int</span> x<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="kw2" style="color: blue; line-height: 13px !important;">public</span><span class="sy4" style="color: teal; line-height: 13px !important;">:</span><br />&nbsp; &nbsp; MyClass<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="sy4" style="color: teal; line-height: 13px !important;">:</span><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="nu0" style="color: #0000dd; line-height: 13px !important;">0</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"Default Constructor"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp; &nbsp; MyClass<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="kw4" style="color: blue; line-height: 13px !important;">int</span> i<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="sy4" style="color: teal; line-height: 13px !important;">:</span><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x<span class="br0" style="color: green; line-height: 13px !important;">(</span>i<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"Parameter Constructor"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp; &nbsp; MyClass<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="kw4" style="color: blue; line-height: 13px !important;">const</span> MyClass<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span> other<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="sy4" style="color: teal; line-height: 13px !important;">:</span><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x<span class="br0" style="color: green; line-height: 13px !important;">(</span>other.<span class="me1" style="color: #007788; line-height: 13px !important;">x</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"Copy Constructor"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">// Two existing objects!</span><br />&nbsp; &nbsp; MyClass<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span> operator<span class="sy1" style="color: navy; line-height: 13px !important;">=</span><span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="kw4" style="color: blue; line-height: 13px !important;">const</span> MyClass<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span> other<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; &nbsp; &nbsp; x <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> other.<span class="me1" style="color: #007788; line-height: 13px !important;">x</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"Copy Assignment Operator"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> <span class="sy2" style="color: #000040; line-height: 13px !important;">*</span><span class="kw3" style="color: #0000dd; line-height: 13px !important;">this</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">//C++11</span><br />&nbsp; &nbsp; MyClass<span class="br0" style="color: green; line-height: 13px !important;">(</span>MyClass<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;&amp;</span> other<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; &nbsp; &nbsp; x <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> std<span class="sy4" style="color: teal; line-height: 13px !important;">::</span><span class="me2" style="color: #007788; line-height: 13px !important;">move</span><span class="br0" style="color: green; line-height: 13px !important;">(</span>other.<span class="me1" style="color: #007788; line-height: 13px !important;">x</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"Move Constructor"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">//C++11</span><br />&nbsp; &nbsp; MyClass<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span> operator<span class="sy1" style="color: navy; line-height: 13px !important;">=</span><span class="br0" style="color: green; line-height: 13px !important;">(</span>MyClass<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;&amp;</span> other<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; &nbsp; &nbsp; x <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> std<span class="sy4" style="color: teal; line-height: 13px !important;">::</span><span class="me2" style="color: #007788; line-height: 13px !important;">move</span><span class="br0" style="color: green; line-height: 13px !important;">(</span>other.<span class="me1" style="color: #007788; line-height: 13px !important;">x</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"Move Operator"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> <span class="sy2" style="color: #000040; line-height: 13px !important;">*</span><span class="kw3" style="color: #0000dd; line-height: 13px !important;">this</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp;<br />&nbsp; &nbsp; <span class="kw4" style="color: blue; line-height: 13px !important;">void</span> setX<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="kw4" style="color: blue; line-height: 13px !important;">int</span> x<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; &nbsp; &nbsp; this<span class="sy2" style="color: #000040; line-height: 13px !important;">-</span><span class="sy1" style="color: navy; line-height: 13px !important;">&gt;</span>x<span class="sy1" style="color: navy; line-height: 13px !important;">=</span>x<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp;<br />&nbsp; &nbsp; <span class="kw2" style="color: blue; line-height: 13px !important;">friend</span> ostream<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span> operator<span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="br0" style="color: green; line-height: 13px !important;">(</span>ostream <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>out, <span class="kw4" style="color: blue; line-height: 13px !important;">const</span> MyClass <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>m<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="br0" style="color: green; line-height: 13px !important;">}</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp;<br />ostream<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span> operator<span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="br0" style="color: green; line-height: 13px !important;">(</span>ostream <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>out, <span class="kw4" style="color: blue; line-height: 13px !important;">const</span> MyClass <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>m<span class="br0" style="color: green; line-height: 13px !important;">)</span><br /><span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; out <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"MyClass x="</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> m.<span class="me1" style="color: #007788; line-height: 13px !important;">x</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> out<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp;<br /><span class="co1" style="color: #666666; line-height: 13px !important;">// Dummy func to show C++11 move &nbsp;constructor</span><br />MyClass f<span class="br0" style="color: green; line-height: 13px !important;">(</span>MyClass m<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> m<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp;<br /><span class="co1" style="color: #666666; line-height: 13px !important;">// create class and return</span><br />MyClass f1<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; MyClass m<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="nu0" style="color: #0000dd; line-height: 13px !important;">10</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> m<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp;<br /><span class="co1" style="color: #666666; line-height: 13px !important;">// return new class</span><br />MyClass f2<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> MyClass<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="nu0" style="color: #0000dd; line-height: 13px !important;">11</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp;<br /><span class="co1" style="color: #666666; line-height: 13px !important;">// Change the value of the class, return ref!</span><br />MyClass<span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span> f3<span class="br0" style="color: green; line-height: 13px !important;">(</span>MyClass <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>m<span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; m.<span class="me1" style="color: #007788; line-height: 13px !important;">setX</span><span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="nu0" style="color: #0000dd; line-height: 13px !important;">21</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> m<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="br0" style="color: green; line-height: 13px !important;">}</span><br />&nbsp;<br />&nbsp;<br /><span class="kw4" style="color: blue; line-height: 13px !important;">int</span> main<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="kw4" style="color: blue; line-height: 13px !important;">void</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="br0" style="color: green; line-height: 13px !important;">{</span><br />&nbsp; &nbsp; MyClass m1<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="nu0" style="color: #0000dd; line-height: 13px !important;">1</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m2 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> m1<span class="sy4" style="color: teal; line-height: 13px !important;">;</span> <span class="co1" style="color: #666666; line-height: 13px !important;">//copy</span><br />&nbsp; &nbsp; MyClass m3<span class="br0" style="color: green; line-height: 13px !important;">(</span>m1<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span> <span class="co1" style="color: #666666; line-height: 13px !important;">//copy</span><br />&nbsp; &nbsp; MyClass m4<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; m4 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> m1<span class="sy4" style="color: teal; line-height: 13px !important;">;</span> <span class="co1" style="color: #666666; line-height: 13px !important;">//Assignment</span><br />&nbsp;<br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"* Move Contructor C++11"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m5<span class="br0" style="color: green; line-height: 13px !important;">(</span>f<span class="br0" style="color: green; line-height: 13px !important;">(</span>MyClass<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"* Move Operator C++11"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m6<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; m6 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> MyClass<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp;<br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"* Optimisation 1:"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m7 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f1<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> m7<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"* Optimisation 2:"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m8 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f2<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> m8<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"* Optimisation 3:"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw4" style="color: blue; line-height: 13px !important;">const</span> MyClass <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>m9 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f1<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> m9<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">// Does not work! lvalue must be const!</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">// f() returns a temporary object (i.e., rvalue) and only lvalues can be bound to references to non-const.</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">// cout &lt;&lt; "Optimisation 4:" &lt;&lt; endl;</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">// MyClass &amp;m10 = f2();</span><br />&nbsp; &nbsp; <span class="co1" style="color: #666666; line-height: 13px !important;">// cout &lt;&lt; m10;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"* NO Optimisation 5:"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m11<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="nu0" style="color: #0000dd; line-height: 13px !important;">15</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">" &nbsp;:( Copy constructor:"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m12 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f3<span class="br0" style="color: green; line-height: 13px !important;">(</span>m11<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">" &nbsp;:( Copy Assignement Operator:"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; m12 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f3<span class="br0" style="color: green; line-height: 13px !important;">(</span>m12<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp;<br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> m12<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> <span class="st0" style="color: red; line-height: 13px !important;">"* Optimisation 6:"</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> endl<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass m13<span class="br0" style="color: green; line-height: 13px !important;">(</span><span class="nu0" style="color: #0000dd; line-height: 13px !important;">15</span><span class="br0" style="color: green; line-height: 13px !important;">)</span> <span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp; &nbsp; MyClass <span class="sy3" style="color: #000040; line-height: 13px !important;">&amp;</span>m14 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f3<span class="br0" style="color: green; line-height: 13px !important;">(</span>m11<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span> <span class="co1" style="color: #666666; line-height: 13px !important;">// if function return ref this is OK! NO COPY!</span><br />&nbsp; &nbsp; m14 <span class="sy1" style="color: navy; line-height: 13px !important;">=</span> f3<span class="br0" style="color: green; line-height: 13px !important;">(</span>m14<span class="br0" style="color: green; line-height: 13px !important;">)</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp;<br />&nbsp; &nbsp; <span class="kw3" style="color: #0000dd; line-height: 13px !important;">cout</span> <span class="sy1" style="color: navy; line-height: 13px !important;">&lt;&lt;</span> m14<span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br />&nbsp;<br />&nbsp; &nbsp; <span class="kw1" style="color: blue; line-height: 13px !important;">return</span> <span class="nu0" style="color: #0000dd; line-height: 13px !important;">0</span><span class="sy4" style="color: teal; line-height: 13px !important;">;</span><br /><span class="br0" style="color: green; line-height: 13px !important;">}</span></pre>
<br /><br /><br /><label
    style="background-color: #eaeaea; color: #333333; display: block; font-family: Helvetica; font-size: 13px; margin-bottom: 3px; margin-left: 0px; margin-top: 5px;">output:</label><br />
<pre class="box"
    style="background-color: #f0f0f0; border: 1px solid rgb(153, 153, 153); font-size: 13px; padding: 0.5em;"><span style="color: #000066;">Parameter Constructor<br />Copy Constructor<br />Copy Constructor<br />Default Constructor<br />Copy Assignment Operator<br />* Move Contructor C++11<br />Default Constructor<br />Move Constructor<br />* Move Operator C++11<br />Default Constructor<br />Default Constructor<br />Move Operator<br />* Optimisation 1:<br />Parameter Constructor<br />MyClass x=10<br />* Optimisation 2:<br />Parameter Constructor<br />MyClass x=11<br />* Optimisation 3:<br />Parameter Constructor<br />MyClass x=10<br />* NO Optimisation 5:<br />Parameter Constructor<br />  :( Copy constructor:<br />Copy Constructor<br />  :( Copy Assignement Operator:<br />Copy Assignment Operator<br />MyClass x=21<br />* Optimisation 6:<br />Parameter Constructor<br /></span><span style="color: red;">Copy Assignment Operator</span><span style="color: #000066;"><br />MyClass x=21</span></pre>