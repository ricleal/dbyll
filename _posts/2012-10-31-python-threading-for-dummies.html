---
layout: post
title: Python threading for dummies
date: '2012-10-31T05:10:00.002-04:00'
author: ricleal
tags:
- Programming
- Python
comments: true
---

Below an example I did for my office mate who wants to get his python code to run on several cores.<br />Pretty usefull
for those who are just starting threads.<br /><br />
<pre
    style="background: #f6f8ff; color: #000020;">#!/usr/bin/python<br /><br /><span style="color: #1060b6;">''</span><span style="color: #1060b6;">'</span><br />@author: Ricardo Leal<br /><span style="color: #1060b6;">''</span><span style="color: #1060b6;">'</span><br />import <span style="color: #200080; font-weight: bold;">time</span><br />import threading<br /><span style="color: #200080; font-weight: bold;">from</span> datetime import datetime<br /><br /># <span style="color: #200080; font-weight: bold;">Lock</span><br /><span style="color: #200080; font-weight: bold;">lock</span> <span style="color: #308080;">=</span> threading.Lock()<br /><br /><br />def myfunc(i):<br />    <span style="color: #1060b6;">''</span><span style="color: #1060b6;">' Function to be threaded '</span><span style="color: #1060b6;">''</span><br />    print <span style="color: #1060b6;">"Tread %d is doing NON critical stuff"</span> % i<br />    <span style="color: #200080; font-weight: bold;">time</span>.sleep(0.5)<br />    <br />    <span style="color: #200080; font-weight: bold;">lock</span>.acquire()<br />    print <span style="color: #1060b6;">"Tread %d is doing critical stuff"</span>% i<br />    <span style="color: #200080; font-weight: bold;">time</span>.sleep(0.5)<br />    print <span style="color: #1060b6;">"Tread %d has finished doing critical stuff"</span> % i <br />    <span style="color: #200080; font-weight: bold;">lock</span>.release()<br /><br />if __name__ <span style="color: #308080;">=</span>= <span style="color: #1060b6;">'__main__'</span>:<br />    <br />    t_start <span style="color: #308080;">=</span> datetime.now()    <br />    <br />    thread_list <span style="color: #308080;">=</span> []<br /><br />    <span style="color: #200080; font-weight: bold;">for</span> i <span style="color: #200080; font-weight: bold;">in</span> range(10):<br />        print <span style="color: #1060b6;">"Launching thread: "</span><span style="color: #308080;">,</span> i<br />        t <span style="color: #308080;">=</span> threading.Thread(target=myfunc<span style="color: #308080;">,</span> args=(i<span style="color: #308080;">,</span>))<br /><span style="color: #595979;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Put threads in a list        </span><br />        thread_list.append(t)<br />        <br /><span style="color: #595979;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# optional (rather than putting them on a list)</span><br /><span style="color: #595979;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# t.start()</span><br />    <br /><span style="color: #595979;">&nbsp;&nbsp;&nbsp;&nbsp;# Start all threads</span><br />    [x.start() <span style="color: #200080; font-weight: bold;">for</span> x <span style="color: #200080; font-weight: bold;">in</span> thread_list]<br /><br />    print <span style="color: #1060b6;">"Waiting for the threads to do their job!"</span><br /><span style="color: #595979;">&nbsp;&nbsp;&nbsp;&nbsp;# Wait for all of them to finish</span><br />    [x.join() <span style="color: #200080; font-weight: bold;">for</span> x <span style="color: #200080; font-weight: bold;">in</span> thread_list]<br />    <br />    print <span style="color: #1060b6;">"Main: I haved waited for the threads to finish!"</span>    <br />    <br />    t_end <span style="color: #308080;">=</span> datetime.now()<br />    t_total <span style="color: #308080;">=</span> t_end - t_start<br />    <br />    print <span style="color: #1060b6;">"Total time: "</span><span style="color: #308080;">,</span> t_total<br />    print <span style="color: #1060b6;">"Main has finished!"</span><br /></pre>